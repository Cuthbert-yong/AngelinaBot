<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="top.strelitzia.arknightsDao.UpdateMapper">

    <select id="selectOperatorIdByName" resultType="java.lang.Integer">
        SELECT
            operator_id
        FROM
            t_operator
        WHERE
            operator_name = #{name}
        AND operator_class is not null
        ORDER BY
            operator_id DESC
        LIMIT 1
    </select>

    <select id="selectSkillIdByName" resultType="java.lang.Integer">
        SELECT
            skill_id
        FROM
            t_operator_skill
        WHERE
            skill_name = #{SkillName}
        ORDER BY
            skill_id DESC
        LIMIT 1
    </select>

    <select id="getVersion" resultType="java.lang.String">
        select data_version from a_data_version
    </select>

    <select id="getVersionStatus" resultType="java.lang.Integer">
        select status from a_data_version limit 1
    </select>

    <update id="doingUpdateVersion">
        update a_data_version set status = 1;
    </update>

    <update id="doingDownloadVersion">
        update a_data_version set status = 2;
    </update>

    <update id="doneUpdateVersion">
        update a_data_version set status = 0;
    </update>

    <update id="updateVersion" parameterType="java.lang.String">
        update a_data_version set data_version = #{newVersion}
    </update>

    <insert id="updateTags">
        insert into t_operator_tags_relation
        (operator_name,operator_rarity,operator_tags)
        values (#{name},#{rarity},#{tags})
    </insert>

    <insert id="insertOperator" parameterType="top.strelitzia.model.OperatorInfo">
        INSERT INTO t_operator (
            operator_name,
            operator_rarity,
            operator_class,
            available,
            in_limit
        )
        VALUES
            (#{operator_name},
            #{operator_rarity},
            #{operator_class},
            #{available},
            #{in_limit})
    </insert>

    <insert id="insertOperatorEvolve" parameterType="top.strelitzia.model.OperatorEvolveInfo">
        INSERT INTO t_operator_evolve_costs (
            operator_id,
            evolve_level,
            use_material_id,
            use_number
        )
        VALUES
            (#{operatorId},
            #{evolveLevel},
            #{useMaterialId},
            #{useNumber})
    </insert>

    <insert id="insertOperatorSkill" parameterType="top.strelitzia.model.OperatorSkillInfo">
        INSERT INTO t_operator_skill (
            operator_id,skill_index,skill_name, skill_id_yj
        )
        VALUES
            (#{operatorId},
            #{skillIndex},
            #{skillName},
            #{skillIdYj})
    </insert>

    <insert id="updateStageData">
        INSERT INTO t_stage
        (stage_id,zone_id,code,ap_cost)
        VALUES
        (
            #{stageId},#{zoneId},#{code},#{apCost}
        )
    </insert>

    <insert id="updateZoneData">
        INSERT INTO t_zone
            (zone_id,zone_name)
        VALUES
        (
            #{zoneId},#{zoneName}
        )
    </insert>

    <insert id="updateItemData">
        INSERT INTO t_material
            (material_id,material_name,material_icon)
        VALUES
        (
            #{id},#{name},#{icon}
        )
    </insert>

    <insert id="updateMatrixData">
        INSERT INTO t_matrix
            (stage_id,item_id,quantity,times,rate)
        VALUES
        (
            #{stageId},#{itemId},#{quantity},#{times},(1.0*#{quantity}/#{times}*100)
        )
    </insert>

    <insert id="insertSkillMater" parameterType="top.strelitzia.model.SkillMaterInfo">
        INSERT INTO t_operator_skill_mastery_costs (
            skill_id,mastery_level,use_material_id,use_number
        )
        VALUES
            (#{skillId},#{materLevel},
            #{useMaterialId},#{useNumber})
    </insert>

    <insert id="updateEnemy" parameterType="top.strelitzia.model.EnemyInfo">
        INSERT INTO t_enemy(
            enemy_id,
            name,
            atk,
            baseAttackTime,
            def,
            hpRecoveryPerSec,
            magicResistance,
            massLevel,
            maxHp,
            moveSpeed,
            rangeRadius,
            level,
            silenceImmune,
            sleepImmune,
            stunImmune)
        VALUES(
            #{enemyId},
            #{name},
            #{atk},
            #{baseAttackTime},
            #{def},
            #{hpRecoveryPerSec},
            #{magicResistance},
            #{massLevel},
            #{maxHp},
            #{moveSpeed},
            #{rangeRadius},
            #{level},
            #{silenceImmune},
            #{sleepImmune},
            #{stunImmune}
            )
    </insert>

    <insert id="insertOperatorTalent" parameterType="top.strelitzia.model.TalentInfo">
        INSERT INTO t_operator_talent (
            operator_id,
            talent_name,
            description,
            phase,
            level,
            potential
        )
        VALUES
            (#{operatorId},
            #{talentName},
            #{description},
            #{phase},
            #{level},
            #{potential})
    </insert>

    <insert id="updateSkillDecs" parameterType="top.strelitzia.model.SkillDesc">
        INSERT INTO t_operator_skill_desc (
            skill_id,
            skill_type,
            sp_type,
            sp_cost,
            sp_init,
            duration,
            description,
            skill_level,
            max_charge
        )
        VALUES
            (#{skillId},
            #{skillType},
            #{spType},
            #{spCost},
            #{spInit},
            #{duration},
            #{description},
            #{skillLevel},
            #{maxCharge})
    </insert>

    <insert id="insertMaterialMade">
        INSERT INTO t_material_made (
            material_id,
            use_material_id,
            use_number
        )
        VALUES
            (#{materialId},
            #{useMaterialId},
            #{useNumber})
    </insert>

    <update id="updateOperatorData" parameterType="top.strelitzia.model.OperatorData">
        UPDATE t_operator
        SET atk = #{atk},
         def= #{def},
         magicResistance= #{magicResistance},
         maxHp= #{maxHp},
         blockCnt= #{blockCnt},
         cost= #{cost},
         baseAttackTime= #{baseAttackTime},
         respawnTime= #{respawnTime}
        WHERE
            operator_id = #{id}
    </update>

    <update id="updateOperatorInfo" parameterType="top.strelitzia.model.OperatorBasicInfo">
        UPDATE t_operator
        SET char_id=#{charId},
        draw_name = #{drawName},
        info_name = #{infoName},
        code_name = #{codeName},
        sex = #{sex},
        come_from = #{comeFrom},
        birthday = #{birthday},
        race = #{race},
        height = #{height},
        infection = #{infection},
        comprehensive_test = #{comprehensiveTest},
        objective_resume = #{objectiveResume},
        clinical_diagnosis = #{clinicalDiagnosis},
        archives1 = #{archives1},
        archives2 = #{archives2},
        archives3 = #{archives3},
        archives4 = #{archives4},
        promotion_info = #{promotionInfo}
        where operator_id = #{operatorId}
    </update>

    <delete id="clearOperatorData">
        DROP TABLE IF EXISTS "t_equip";
        CREATE TABLE "t_equip" (
            "id" INTEGER PRIMARY KEY AUTOINCREMENT,
            "equip_id" varchar(255) NOT NULL,
            "equip_name" varchar(255) NOT NULL,
            "char_id" varchar(255) DEFAULT NULL,
            "phase" int DEFAULT NULL,
            "level" int DEFAULT NULL,
            "desc" varchar(255) DEFAULT NULL
        );

        DROP TABLE IF EXISTS "t_equip_buff";
        CREATE TABLE "t_equip_buff" (
            "buff_id" INTEGER PRIMARY KEY AUTOINCREMENT,
            "equip_id" varchar(255) DEFAULT NULL,
            "buff_name" varchar(255) DEFAULT NULL,
            "value" double(255,2) DEFAULT NULL
        );

        DROP TABLE IF EXISTS "t_equip_cost";
        CREATE TABLE "t_equip_cost" (
            "id" INTEGER PRIMARY KEY AUTOINCREMENT,
            "equip_id" varchar(255) DEFAULT NULL,
            "material_id" varchar(255) DEFAULT NULL,
            "use_number" int DEFAULT NULL
        );

        DROP TABLE IF EXISTS "t_equip_mission";
        CREATE TABLE "t_equip_mission" (
            "id" INTEGER PRIMARY KEY AUTOINCREMENT,
            "equip_id" varchar(255) DEFAULT NULL,
            "mission_id" varchar(255) DEFAULT NULL,
            "mission_desc" varchar(255) DEFAULT NULL
        );

        DROP TABLE IF EXISTS "t_operator";
        CREATE TABLE "t_operator" (
            "operator_id" INTEGER PRIMARY KEY AUTOINCREMENT,
            "char_id" varchar(255) DEFAULT NULL,
            "operator_name" varchar(255) DEFAULT NULL,
            "operator_rarity" tinyint DEFAULT NULL,
            "operator_class" tinyint DEFAULT NULL,
            "available" tinyint DEFAULT 0,
            "in_limit" tinyint DEFAULT NULL,
            "atk" int DEFAULT 0,
            "def" int DEFAULT 0,
            "magicResistance" int DEFAULT 0,
            "maxHp" int DEFAULT 0,
            "blockCnt" int DEFAULT 0,
            "cost" int DEFAULT 0,
            "baseAttackTime" double DEFAULT 0,
            "respawnTime" int DEFAULT 0,
            "draw_name" varchar(255),
            "info_name" varchar(255) DEFAULT NULL,
            "code_name" varchar(255) DEFAULT NULL,
            "sex" varchar(255) DEFAULT NULL,
            "come_from" varchar(255) DEFAULT NULL,
            "birthday" varchar(255) DEFAULT NULL,
            "race" varchar(255) DEFAULT NULL,
            "height" int DEFAULT NULL,
            "infection" varchar(255) DEFAULT NULL,
            "comprehensive_test" text,
            "objective_resume" text,
            "clinical_diagnosis" text,
            "archives1" text,
            "archives2" text,
            "archives3" text,
            "archives4" text,
            "promotion_info" text
        );

        DROP TABLE IF EXISTS "t_operator_building_skill";
        CREATE TABLE "t_operator_building_skill" (
            "id" INTEGER PRIMARY KEY AUTOINCREMENT,
            "operator_id" int DEFAULT NULL,
            "phase" int DEFAULT NULL,
            "level" int DEFAULT NULL,
            "buff_name" varchar(255) DEFAULT NULL,
            "room_type" varchar(255) DEFAULT NULL,
            "description" varchar(255) DEFAULT NULL
        );

        DROP TABLE IF EXISTS "t_operator_evolve_costs";
        CREATE TABLE "t_operator_evolve_costs" (
            "cost_id" INTEGER PRIMARY KEY AUTOINCREMENT,
            "operator_id" int DEFAULT NULL,
            "evolve_level" tinyint DEFAULT NULL,
            "use_material_id" varchar(255) DEFAULT NULL,
            "use_number" tinyint DEFAULT NULL
        );

        DROP TABLE IF EXISTS "t_operator_skill";
        CREATE TABLE "t_operator_skill" (
            "skill_id" INTEGER PRIMARY KEY AUTOINCREMENT,
            "operator_id" int DEFAULT NULL,
            "skill_index" tinyint DEFAULT NULL,
            "skill_name" varchar(255) DEFAULT NULL,
            "skill_png" varchar(255),
            "skill_id_yj" varchar(255)
        );

        DROP TABLE IF EXISTS "t_operator_skill_desc";
        CREATE TABLE "t_operator_skill_desc" (
            "id" INTEGER PRIMARY KEY AUTOINCREMENT,
            "skill_id" int DEFAULT NULL,
            "skill_type" int DEFAULT NULL,
            "sp_type" int DEFAULT NULL,
            "sp_cost" int DEFAULT NULL,
            "sp_init" int DEFAULT NULL,
            "duration" int DEFAULT NULL,
            "description" varchar(255) DEFAULT NULL,
            "skill_level" int DEFAULT NULL,
            "max_charge" int DEFAULT NULL
        );

        DROP TABLE IF EXISTS "t_operator_skill_mastery_costs";
        CREATE TABLE "t_operator_skill_mastery_costs" (
            "cost_id" INTEGER PRIMARY KEY AUTOINCREMENT,
            "skill_id" int DEFAULT NULL,
            "mastery_level" tinyint DEFAULT NULL,
            "use_material_id" varchar(255) DEFAULT NULL,
            "use_number" int DEFAULT NULL
        );

        DROP TABLE IF EXISTS "t_operator_tags_relation";
        CREATE TABLE "t_operator_tags_relation" (
            "id" INTEGER PRIMARY KEY AUTOINCREMENT,
            "operator_name" varchar(255) NOT NULL,
            "operator_rarity" tinyint NOT NULL,
            "operator_tags" varchar(255) NOT NULL
        );

        DROP TABLE IF EXISTS "t_operator_talent";
        CREATE TABLE "t_operator_talent" (
            "talent_id" INTEGER PRIMARY KEY AUTOINCREMENT,
            "operator_id" int DEFAULT NULL,
            "talent_name" varchar(255) DEFAULT NULL,
            "description" varchar(255) DEFAULT NULL,
            "phase" int DEFAULT NULL,
            "level" int DEFAULT NULL,
            "potential" int DEFAULT NULL
        );
    </delete>

    <delete id="clearMatrixData">
        DELETE FROM t_matrix where matrix_id IN (SELECT matrix_id FROM t_matrix LIMIT 100);
    </delete>

    <select id="selectMatrixCount" resultType="java.lang.Integer">
        select count(matrix_id) from t_matrix;
    </select>
</mapper>